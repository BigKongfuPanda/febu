<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>顺序图</title>
</head>

<body>
<h2>发布到测试环境</h2>
<div class="mermaid">
sequenceDiagram
	participant 远程仓库
	participant src
	participant build
	participant development
	opt 未初始化
		远程仓库->>src: git clone
	end
	远程仓库->>src: git pull
	src->>src: git.checkout
	src->>development: 复制静态资源
	opt AMD
		src->>build: js: optimize
		build->>development: 复制js
	end
	src->>development: VM: 替换静态资源链接
	development->>development: 后处理
</div>

<h2>发布到生产环境</h2>
<div class="mermaid">
sequenceDiagram
	participant 远程仓库
	participant src
	participant build
	participant production
	opt 未初始化
		远程仓库->>src: git clone
	end
	远程仓库->>src: git pull
	src->>src: git.checkout
	src->>production: 除js、css的静态资源：打版本
	src->>build: css: 替换静态资源内链
	build->>production: 压缩，打版本
	alt AMD
		src->>build: js: optimize
		build->>production: 打版本
		src->>build: config.js: 替换paths值
		build->>production: 压缩，打版本
	else 非AMD
		src->production: js: 压缩，打版本
	end
	src->>build: VM: 替换静态资源内链
	build->>production: 处理特殊标记
	Note right of build: _group, _inline, _compress<br/>
	build->>production: 复制VM
	production->>production: 后处理
</div>

<h2>回滚</h2>
<div class="mermaid">
sequenceDiagram
	production->>production: git.checkout
</div>

<script src="https://cdn.rawgit.com/knsv/mermaid/master/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>	
</body>
</html>